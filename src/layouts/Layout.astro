---
import Analytics from '@vercel/analytics/astro';

interface Props {
  title: string;
  description?: string;
  image?: string;
  type?: 'website' | 'article';
  author?: string;
  publishedTime?: string;
  modifiedTime?: string;
  tags?: string[];
  noindex?: boolean;
}

const {
  title,
  description = 'Create production-ready cosmetic packaging in minutes with AI-powered design. Connect directly with vetted China manufacturers for low MOQ, high-quality production. From concept to doorstep in 3 weeks.',
  image = '/images/og-image.svg',
  type = 'website',
  author,
  publishedTime,
  modifiedTime,
  tags = [],
  noindex = false
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const siteName = 'Packaging Fast';
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content={Astro.generator} />

    <!-- Primary Meta Tags -->
    <title>{title}</title>
    <meta name="title" content={title} />
    <meta name="description" content={description} />
    <meta name="keywords" content="AI packaging design, cosmetic packaging sourcing, 3D packaging editor, custom perfume bottles, China packaging manufacturers, low MOQ cosmetic containers, AI packaging generator, online 3D mockup maker, skincare bottle design software, packaging CAD tool, virtual packaging prototype" />
    <meta name="author" content={author || siteName} />
    <meta name="robots" content={noindex ? 'noindex, nofollow' : 'index, follow'} />
    <meta name="googlebot" content={noindex ? 'noindex, nofollow' : 'index, follow'} />

    <!-- Canonical URL -->
    <link rel="canonical" href={canonicalURL} />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={type} />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={new URL(image, Astro.site)} />
    <meta property="og:site_name" content={siteName} />
    <meta property="og:locale" content="en_US" />
    {publishedTime && <meta property="article:published_time" content={publishedTime} />}
    {modifiedTime && <meta property="article:modified_time" content={modifiedTime} />}
    {author && <meta property="article:author" content={author} />}
    {tags.length > 0 && tags.map(tag => <meta property="article:tag" content={tag} />)}

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@packstudio3d" />
    <meta name="twitter:url" content={canonicalURL} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={new URL(image, Astro.site)} />

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title={`${siteName} Blog`} href="/blog/rss.xml" />

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />

    <!-- Preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet" />

    <!-- Structured Data -->
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": type === 'article' ? "Article" : "WebSite",
      "name": siteName,
      "url": Astro.site,
      "description": description,
      ...(type === 'article' && {
        "headline": title,
        "author": {
          "@type": "Person",
          "name": author
        },
        "publisher": {
          "@type": "Organization",
          "name": siteName,
          "logo": {
            "@type": "ImageObject",
            "url": new URL("/favicon.svg", Astro.site)
          }
        },
        "datePublished": publishedTime,
        "dateModified": modifiedTime || publishedTime,
        "keywords": tags.join(', ')
      })
    })} />

    <!-- Breadcrumb Schema (for article pages) -->
    {type === 'article' && (
      <script type="application/ld+json" set:html={JSON.stringify({
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
          {
            "@type": "ListItem",
            "position": 1,
            "name": "Home",
            "item": Astro.site
          },
          {
            "@type": "ListItem",
            "position": 2,
            "name": "Blog",
            "item": new URL('/blog', Astro.site)
          },
          {
            "@type": "ListItem",
            "position": 3,
            "name": title,
            "item": canonicalURL
          }
        ]
      })} />
    )}

    <!-- Organization Schema -->
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": siteName,
      "url": Astro.site,
      "logo": new URL("/favicon.svg", Astro.site),
      "sameAs": [
        "https://twitter.com/packstudio3d",
        "https://www.linkedin.com/company/packstudio3d",
        "https://instagram.com/packstudio3d"
      ]
    })} />

    <slot name="head" />

    <!-- Clarity -->
    <script type="text/javascript">
      (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
      })(window, document, "clarity", "script", "v02quzczap");
    </script>
  </head>
  <body>
    <slot />
    <Analytics />
  </body>
</html>

<style is:global>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  :root {
    --primary: #1a1a1a;
    --accent: #5747F4;
    --accent-light: #e8ecff;
    --bg: #fafafa;
    --white: #fff;
    --gray-100: #f5f5f5;
    --gray-200: #eee;
    --gray-300: #ddd;
    --gray-400: #ccc;
    --gray-500: #888;
    --gray-600: #666;
  }
  html {
    scroll-behavior: smooth;
  }
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    color: var(--primary);
    background: var(--bg);
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
  }
  a { color: inherit; text-decoration: none; }
  img { max-width: 100%; height: auto; display: block; }
  button { font-family: inherit; }
</style>
